!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,i=i.L||(i.L={}),i=i.Control||(i.Control={}),i.LineStringSelect=t()}}(function(){return function t(i,e,n){function r(s,a){if(!e[s]){if(!i[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=e[s]={exports:{}};i[s][0].call(c.exports,function(t){var e=i[s][1][t];return r(e?e:t)},c,c.exports,t,i,e,n)}return e[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,i,e){(function(e){/**
 * Leaflet LineString selection control
 * @license MIT
 * @author Alexander Milevski <info@w8r.name>
 * @preserve
 */
var n="undefined"!=typeof window?window.L:"undefined"!=typeof e?e.L:null;n.Control.LineStringSelect=i.exports=t("./src/select")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/select":7}],2:[function(t,i,e){"use strict";function n(t,i,e,s,a){for(e=e||0,s=s||t.length-1,a=a||o;s>e;){if(s-e>600){var h=s-e+1,l=i-e+1,c=Math.log(h),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(h-u)/h)*(l-h/2<0?-1:1),f=Math.max(e,Math.floor(i-l*u/h+d)),_=Math.min(s,Math.floor(i+(h-l)*u/h+d));n(t,i,f,_,a)}var g=t[i],m=e,p=s;for(r(t,e,i),a(t[s],g)>0&&r(t,e,s);m<p;){for(r(t,m,p),m++,p--;a(t[m],g)<0;)m++;for(;a(t[p],g)>0;)p--}0===a(t[e],g)?r(t,e,p):(p++,r(t,p,s)),p<=i&&(e=p+1),i<=p&&(s=p-1)}}function r(t,i,e){var n=t[i];t[i]=t[e],t[e]=n}function o(t,i){return t<i?-1:t>i?1:0}i.exports=n},{}],3:[function(t,i,e){"use strict";function n(t,i){return this instanceof n?(this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&this._initFormat(i),void this.clear()):new n(t,i)}function r(t,i,e){if(!e)return i.indexOf(t);for(var n=0;n<i.length;n++)if(e(t,i[n]))return n;return-1}function o(t,i){s(t,0,t.children.length,i,t)}function s(t,i,e,n,r){r||(r=m(null)),r.minX=1/0,r.minY=1/0,r.maxX=-(1/0),r.maxY=-(1/0);for(var o,s=i;s<e;s++)o=t.children[s],a(r,t.leaf?n(o):o);return r}function a(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function h(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,i){return(Math.max(i.maxX,t.maxX)-Math.min(i.minX,t.minX))*(Math.max(i.maxY,t.maxY)-Math.min(i.minY,t.minY))}function f(t,i){var e=Math.max(t.minX,i.minX),n=Math.max(t.minY,i.minY),r=Math.min(t.maxX,i.maxX),o=Math.min(t.maxY,i.maxY);return Math.max(0,r-e)*Math.max(0,o-n)}function _(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function g(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-(1/0),maxY:-(1/0)}}function p(t,i,e,n,r){for(var o,s=[i,e];s.length;)e=s.pop(),i=s.pop(),e-i<=n||(o=i+Math.ceil((e-i)/n/2)*n,M(t,o,i,e,r),s.push(i,o,o,e))}i.exports=n;var M=t("quickselect");n.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,e=[],n=this.toBBox;if(!g(t,i))return e;for(var r,o,s,a,h=[];i;){for(r=0,o=i.children.length;r<o;r++)s=i.children[r],a=i.leaf?n(s):s,g(t,a)&&(i.leaf?e.push(s):_(t,a)?this._all(s,e):h.push(s));i=h.pop()}return e},collides:function(t){var i=this.data,e=this.toBBox;if(!g(t,i))return!1;for(var n,r,o,s,a=[];i;){for(n=0,r=i.children.length;n<r;n++)if(o=i.children[n],s=i.leaf?e(o):o,g(t,s)){if(i.leaf||_(t,s))return!0;a.push(o)}i=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,e=t.length;i<e;i++)this.insert(t[i]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(t,i){if(!t)return this;for(var e,n,o,s,a=this.data,h=this.toBBox(t),l=[],c=[];a||l.length;){if(a||(a=l.pop(),n=l[l.length-1],e=c.pop(),s=!0),a.leaf&&(o=r(t,a.children,i),o!==-1))return a.children.splice(o,1),l.push(a),this._condense(l),this;s||a.leaf||!_(a,h)?n?(e++,a=n.children[e],s=!1):a=null:(l.push(a),c.push(e),e=0,n=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:h,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var e=[];t;)t.leaf?i.push.apply(i,t.children):e.push.apply(e,t.children),t=e.pop();return i},_build:function(t,i,e,n){var r,s=e-i+1,a=this._maxEntries;if(s<=a)return r=m(t.slice(i,e+1)),o(r,this.toBBox),r;n||(n=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,n-1))),r=m([]),r.leaf=!1,r.height=n;var h,l,c,u,d=Math.ceil(s/a),f=d*Math.ceil(Math.sqrt(a));for(p(t,i,e,f,this.compareMinX),h=i;h<=e;h+=f)for(c=Math.min(h+f-1,e),p(t,h,c,d,this.compareMinY),l=h;l<=c;l+=d)u=Math.min(l+d-1,c),r.children.push(this._build(t,l,u,n-1));return o(r,this.toBBox),r},_chooseSubtree:function(t,i,e,n){for(var r,o,s,a,h,l,u,f;;){if(n.push(i),i.leaf||n.length-1===e)break;for(u=f=1/0,r=0,o=i.children.length;r<o;r++)s=i.children[r],h=c(s),l=d(t,s)-h,l<f?(f=l,u=h<u?h:u,a=s):l===f&&h<u&&(u=h,a=s);i=a||i.children[0]}return i},_insert:function(t,i,e){var n=this.toBBox,r=e?t:n(t),o=[],s=this._chooseSubtree(r,this.data,i,o);for(s.children.push(t),a(s,r);i>=0&&o[i].children.length>this._maxEntries;)this._split(o,i),i--;this._adjustParentBBoxes(r,o,i)},_split:function(t,i){var e=t[i],n=e.children.length,r=this._minEntries;this._chooseSplitAxis(e,r,n);var s=this._chooseSplitIndex(e,r,n),a=m(e.children.splice(s,e.children.length-s));a.height=e.height,a.leaf=e.leaf,o(e,this.toBBox),o(a,this.toBBox),i?t[i-1].children.push(a):this._splitRoot(e,a)},_splitRoot:function(t,i){this.data=m([t,i]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,e){var n,r,o,a,h,l,u,d;for(l=u=1/0,n=i;n<=e-i;n++)r=s(t,0,n,this.toBBox),o=s(t,n,e,this.toBBox),a=f(r,o),h=c(r)+c(o),a<l?(l=a,d=n,u=h<u?h:u):a===l&&h<u&&(u=h,d=n);return d},_chooseSplitAxis:function(t,i,e){var n=t.leaf?this.compareMinX:h,r=t.leaf?this.compareMinY:l,o=this._allDistMargin(t,i,e,n),s=this._allDistMargin(t,i,e,r);o<s&&t.children.sort(n)},_allDistMargin:function(t,i,e,n){t.children.sort(n);var r,o,h=this.toBBox,l=s(t,0,i,h),c=s(t,e-i,e,h),d=u(l)+u(c);for(r=i;r<e-i;r++)o=t.children[r],a(l,t.leaf?h(o):o),d+=u(l);for(r=e-i-1;r>=i;r--)o=t.children[r],a(c,t.leaf?h(o):o),d+=u(c);return d},_adjustParentBBoxes:function(t,i,e){for(var n=e;n>=0;n--)a(i[n],t)},_condense:function(t){for(var i,e=t.length-1;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():o(t[e],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},{quickselect:2}],4:[function(t,i,e){var n=t("./marker"),r=n.extend({options:{radiusRatio:1.2},onAdd:function(t){this.on("mouseover",this._onMouseOver,this).on("mouseout",this._onMouseOut,this),n.prototype.onAdd.call(this,t)},onRemove:function(t){this.off("mouseover",this._onMouseOver,this).off("mouseout",this._onMouseOut,this),n.prototype.onRemove.call(this,t)},_onMouseOver:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},_onMouseOut:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});i.exports=r},{"./marker":6}],5:[function(t,i,e){function n(t,i){var e=t[0]-i[0],n=t[1]-i[1];return e*e+n*n}function r(t,i){return Math.sqrt(n(t,i))}function o(t,i,e){var r=e[0]-i[0],o=e[1]-i[1],s=r*r+o*o,a=s&&((t[0]-i[0])*r+(t[1]-i[1])*(e[1]-i[1]))/s;return n(t,a<=0?i:a>=1?e:[i[0]+a*r,i[1]+a*o])}function s(t,i,e){var n=e[0]-i[0],r=e[1]-i[1],o=t[0]-i[0],s=t[1]-i[1],a=(o*n+s*r)/(n*n+r*r);return a<0?0:a>1?1:a}function a(t,i,e){var n=s(t,i,e),r=e[0]-i[0],o=e[1]-i[1],a=[i[0]+n*r,i[1]+n*o];return a}function h(t,i,e){return t+e*(i-t)}function l(t,i,e,n){var r=e/n;return[h(t[0],i[0],r),h(t[1],i[1],r)]}i.exports={pointSegmentDistance:o,closestPointOnSegment:a,pointOnSegment:l,distance:r}},{}],6:[function(t,i,e){(function(t){var e="undefined"!=typeof window?window.L:"undefined"!=typeof t?t.L:null,n=e.CircleMarker.extend({show:function(){return this._container.style.visibility="",this},hide:function(){return this._container.style.visibility="hidden",this}});i.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(t,i,e){(function(e){var n="undefined"!=typeof window?window.L:"undefined"!=typeof e?e.L:null,r=t("./geometry"),o=t("./marker"),s=t("./endpoint"),a=t("./selection"),h=e.rbush||t("rbush"),l=n.Control.extend({includes:n.Mixin.Events,statics:{Selection:a,Endpoint:s,ControlMarker:o},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:4,lineTolerance:n.Browser.touch?10:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:n.Browser.touch,position:"topright"},initialize:function(t){t=t||{},this._startMarker=null,this._endMarker=null,this._movingMarker=null,this._feature=null,this._layer=null,this._selection=null,this._tolerance=null,n.Util.setOptions(this,t),n.Control.prototype.initialize.call(this,this.options)},onAdd:function(t){var i=this._container=n.DomUtil.create("div",this.options.containerClass);return n.DomEvent.disableClickPropagation(i).disableScrollPropagation(i),i},onRemove:function(t){this.disable()},enable:function(t){return this._layer=t.layer,this._feature=t.feature||t.layer.toGeoJSON(),this._createHandles(),this._buildTree(),this._layer.on("click",this._onLayerClick,this),this._map.on("moveend zoomend resize",this._calculatePointerTolerance,this).on("mousemove touchmove",this._onMousemove,this).on(n.Draggable.START.join(" "),this._onMouseDown,this).on("click contextmenu",this._onMapClick,this),this._calculatePointerTolerance(),this},disable:function(){return this.reset(),this._map.removeLayer(this._movingMarker),this._movingMarker=null,this._layer.off("click",this._onLayerClick,this),this._map.off("moveend zoomend resize",this._calculatePointerTolerance,this).off("mousemove touchmove",this._onMousemove,this).off(n.Draggable.START.join(" "),this._onMouseDown,this).off("click contextmenu",this._onMapClick,this),this._feature=null,this._layer=null,this},reset:function(){return this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null),this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null),this._selection&&(this._map.removeLayer(this._selection),this._selection=null),this._movingMarker.setLatLng(this._layer.getLatLngs()[0]),this.options.useTouch||this._movingMarker.show(),this.fire("reset"),this},getSelection:function(){return this._selection?this._selection.getLatLngs():null},toGeoJSON:function(){return this._selection?this._selection.toGeoJSON():null},selectMeters:function(t,i){if(this.reset(),t<0||i<0)throw new Error("Can't use negative meter values for distance selection");var e=this._pointAtM(t),n=this._pointAtM(i);return e=this._getNearestPoint(e),n=this._getNearestPoint(n),this._setPoint(e,e.start,e.end),this._setPoint(n,n.start,n.end),this},movingMarkerFactory:function(t,i){return new o(t,i)},endpointFactory:function(t,i,e){return new s(t,i)},selectionFactory:function(t,i,e){return new a(t,i,e)},_distance:function(t,i){return this.options.distance?this.options.distance(t,i):new n.LatLng(t[1],t[0]).distanceTo(new n.LatLng(i[1],i[0]))},_getProjectedPoint:function(t){return this.options.getProjectedPoint?this.options.getProjectedPoint.call(this,t):(t=this._map.options.crs.latLngToPoint(new n.LatLng(t[1],t[0]),this._map.getMaxZoom()),[t.x,t.y])},_pointAtSegmentM:function(t,i,e){var o=this._distance(t,i);t=this._getProjectedPoint(t),i=this._getProjectedPoint(i);var s=r.pointOnSegment(t,i,e,o);return n.point(s)},_pointAtM:function(t){var i,e,r,o=this._feature.geometry.coordinates,s=0;for(e=1,r=o.length;e<r;e++){var a=this._distance(o[e-1],o[e]);if(!(s+a<=t))break;s+=a}return s===t||e===o.length?(i=o[e-1],new n.LatLng(i[1],i[0])):(i=this._pointAtSegmentM(o[e-1],o[e],t-s),this._map.options.crs.pointToLatLng(i,this._map.getMaxZoom()))},_calculatePointerTolerance:function(){var t=this._map.getCenter(),i=.5*this.options.lineWeight+this.options.lineTolerance,e=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(t).add(new n.Point(i,i)));this._tolerance=new n.LatLng(Math.abs(t.lat-e.lat),Math.abs(t.lng-e.lng))},_createHandles:function(){var t=n.latLng(this._layer._latlngs[0]),i=this.options.movingMarkerStyle;i.radius=this.options.lineTolerance,i.className=this.options.movingMarkerClass,this._movingMarker=this.movingMarkerFactory(t,i).addTo(this._map),this._movingMarker.on("click",this._onMovingMarkerClick,this),this.options.useTouch&&this._movingMarker.hide()},_onMovingMarkerClick:function(t){this._setPoint(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},_onLayerClick:function(t){var i=this._getNearestPoint(t.latlng);i?this._setPoint(n.latLng(i),i.start,i.end):this._setPoint(t.latlng)},_onMapClick:function(t){if(!this._endMarker){var i=this._map.latLngToLayerPoint(t.latlng),e=this._movingMarker.getLatLng();if(this.options.useTouch){var o=this._getNearestPoint(t.latlng);o&&(e=n.latLng(o),this._movingMarker.setLatLng(e))}var s=this._map.latLngToLayerPoint(e),a=r.distance([i.x,i.y],[s.x,s.y]);a<=2*this.options.lineTolerance&&(e=this._getNearestPoint(e),this._setPoint(e,e.start,e.end))}},_setPoint:function(t,i,e){var n=this.options.endpointStyle;this._startMarker?this._endMarker||(n.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(t,n,!0).addTo(this._map),this._endMarker.start=i,this._endMarker.end=e,this._movingMarker.hide(),this.fire("select:end",{latlng:t}),this._startMarker&&this._endMarker&&this._onSelect()):(n.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(t,n,!1).addTo(this._map),this._startMarker.start=i,this._startMarker.end=e,this.fire("select:start",{latlng:t}))},_getPointerBounds:function(t){var i=this._tolerance.lng,e=this._tolerance.lat;return{minY:t.lat-e,minX:t.lng-i,maxY:t.lat+e,maxX:t.lng+i}},_onMouseDown:function(t){var i=t.originalEvent.target||t.originalEvent.srcElement;if(this.options.useTouch){var e;this._startMarker&&(e=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),r.distance([t.containerPoint.x,t.containerPoint.y],[e.x,e.y])<=2*this.options.lineTolerance&&(i=this._startMarker._path)),this._endMarker&&(e=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),r.distance([t.containerPoint.x,t.containerPoint.y],[e.x,e.y])<=2*this.options.lineTolerance&&(i=this._endMarker._path))}this._startMarker&&this._startMarker._path===i?(this._dragging=this._startMarker,this._static=this._endMarker):this._endMarker&&this._endMarker._path===i&&(this._dragging=this._endMarker,this._static=this._startMarker),this._dragging&&(n.DomEvent.stop(t),this._dragging._dragging=!0,n.Draggable._disabled=!0,this._map.dragging.disable(),this._map.once("mouseup",this._stopHandlerDrag,this))},_stopHandlerDrag:function(t){this._dragging&&(e.clearTimeout(this._dragTimer),n.Draggable._disabled=!1,this._map.dragging.enable(),this._dragging._dragging=null,this._dragging=null,this._onDragStopped(this._dragging,t.latlng))},_onDragStopped:function(t,i){this._startMarker&&this._endMarker&&this._onSelect()},_checkEndPoints:function(){if(this._startMarker.start>this._endMarker.start){var t=this._startMarker;this._startMarker=this._endMarker,this._endMarker=t}},_onSelect:function(){this._checkEndPoints();var t=this._startMarker.end,i=this._endMarker.start,e=this._layer._latlngs.slice(t,i+1);e.unshift(this._startMarker.getLatLng()),e.push(this._endMarker.getLatLng()),this._selection?(this._selection._latlngs=e,this._selection.updatePathFromSource(this._startMarker.end,this._endMarker.start)):(this._selection=this.selectionFactory(e,this.options.selectionStyle,this._layer).addTo(this._map),this._startMarker.bringToFront(),this._endMarker.bringToFront()),this.fire("selection")},_onMousemove:function(t){var i=this._getNearestPoint(t.latlng);this._dragging?(i&&(this._dragging.start=i.start,this._dragging.end=i.end,this._dragging.setLatLng(i)),this._startMarker&&this._endMarker&&this._onSelect(),e.clearTimeout(this._dragTimer),this._dragTimer=e.setTimeout(this._stopHandlerDrag.bind(this,t),750)):i&&(this._movingMarker.setLatLng(i),this._movingMarker.start=i.start,this._movingMarker.end=i.end)},_getNearestPoint:function(t,i){var e=this._getPointerBounds(t,i),n=this._tree.search(e);if(0!==n.length){var o=this._feature.geometry.coordinates,s=Number.MAX_VALUE,a=[t.lng,t.lat],h=n[0].start,l=n[0].end,c=o[h],u=o[l];if(n.length>1)for(var d=0,f=n.length;d<f;d++){var _=o[n[d].start],g=o[n[d].end],m=r.pointSegmentDistance(a,_,g);m<s&&(s=m,c=_,u=g,h=n[d].start,l=n[d].end)}return a=r.closestPointOnSegment(a,c,u),a=[a[1],a[0]],a.start=h,a.end=l,a}return null},_buildTree:function(){var t=this._feature.geometry.coordinates,i=[];this._tree?this._tree.clear():this._tree=h(9,["[0]","[1]","[2]","[3]"]);for(var e=1,n=t.length;e<n;e++){var r=this._toTreeNode(t[e-1],t[e]);r.start=e-1,r.end=e,i.push(r)}this._tree.load(i)},_toTreeNode:function(t,i){var e=t[0],n=i[0],r=t[1],o=i[1];return e>n&&(n=t[0],e=i[0]),r>o&&(o=t[1],r=i[1]),[e,r,n,o]}});i.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./endpoint":4,"./geometry":5,"./marker":6,"./selection":8,rbush:3}],8:[function(t,i,e){(function(t){var e="undefined"!=typeof window?window.L:"undefined"!=typeof t?t.L:null,n=e.Polyline.extend({initialize:function(t,i,n){this._source=n,e.Polyline.prototype.initialize.call(this,t,i)},updatePathFromSource:function(t,i){this._originalPoints=this._source._originalPoints.slice(t,i+1),this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0])),this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-1])),this._updatePath()}});i.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});
